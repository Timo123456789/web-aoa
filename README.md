# Web AOA

## Configuration

There are a few environment variables (see `.env`) that can be set to configure the services dynamically.

| Variable                     | Default                 | Description                                                                  |
| ---------------------------- | ----------------------- | ---------------------------------------------------------------------------- |
| `NODE_ENV`                   | `dev`                   | Please use `production` for the use in production.                           |
| `FRONTEND_PORT`              | `3000`                  | Under which port the Frontend should be accessible.                          |
| `API_URL`                    | `http://localhost:9000` | Used by the frontend and Swagger.                                            |
| `API_PORT`                   | `9000`                  | Under which port the API should be accessible.                               |
| `API_COMMAND                 | `start`                 | See `package.json` for more commands. Please use `start:prod` in production. |
| `MONGODB_CONNECTION_STRING`  | `-`                     | For the API.                                                                 |
| `JWT_SECRET`                 | `-`                     | The secret for the JWT tokens which are generated by the API.                |
| `API_KEY`                    | `-`                     | Specifies the `X-API-KEY` for the API which is required to manage users.     |
| `MAX_UPLOAD_FILE_SIZE_MB`    | `10`                    | Max upload file size (e.g. \*.rds files).                                    |
| `MONGO_INITDB_ROOT_USERNAME` | `-`                     | MongoDB root username.                                                       |
| `MONGO_INITDB_ROOT_PASSWORD` | `-`                     | MongoDB root password.                                                       |
| `MONGO_INITDB_DATABASE`      | `-`                     | Database name.                                                               |
| `MONGO_INITDB_API_USERNAME`  | `-`                     | MongoDB API username.                                                        |
| `MONGO_INITDB_API_PASSWORD`  | `-`                     | MongoDB API password.                                                        |

The following environment variables are required for the first start. It's not possible to change these values afterwards.

| Variable                     | Default | Description            |
| ---------------------------- | ------- | ---------------------- |
| `MONGO_INITDB_ROOT_USERNAME` | `-`     | MongoDB root username. |
| `MONGO_INITDB_ROOT_PASSWORD` | `-`     | MongoDB root password. |
| `MONGO_INITDB_DATABASE`      | `-`     | Database name.         |
| `MONGO_INITDB_API_USERNAME`  | `-`     | MongoDB API username.  |
| `MONGO_INITDB_API_PASSWORD`  | `-`     | MongoDB API password.  |

> Please make sure you're using the right credentials (`MONGO_INITDB_API_*`) for `MONGODB_CONNECTION_STRING`.

## Development

```sh
docker-compose up
```

Or add the build flag to make sure, that everything is up to date.

```sh
docker-compose up --build
```

> All changes in `src` will be reloaded after the code (file) is changed. No need to restart the docker container.

## Production

Make sure the services are not running:

```sh
sudo docker-compose down
```

Pull changes from `main`:

```sh
git pull
```

Pull docker images:

```sh
sudo docker-compose pull
```

Start all services:

```sh
sudo docker-compose --env-file .env.production up --no-build -d
```

> Please use the `.env` for your `.env.production` and change the credentials!
> For more information about the environment variables see the section [Configuration](#configuration).
